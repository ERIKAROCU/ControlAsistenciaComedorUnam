<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Inasistencias - UNAM</title>
    <link rel="stylesheet" href="../css/estilo-fut.css">
</head>
<body>
    <table border="1">
        <tr>
            <th>DNI</th>
            <th>Nombres</th>
        </tr>
        <?php include 'datos_inasistencias.php'; ?>
        <?php if ($result->num_rows > 0): ?>
            <?php while ($row = $result->fetch_assoc()): ?>
                <tr onclick="llenarCampos(
                    '<?php echo htmlspecialchars($row['id_registro'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['solicitud'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['dependencia'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['tipo_documento_identidad'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['apellido_paterno'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['apellido_materno'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['nombres'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['DNI'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['direccion'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['distrito'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['provincia'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['departamento'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['email'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['telefono'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['celular'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['fundamento_solicitud'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['codigo_estudiante'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo htmlspecialchars($row['observacion'], ENT_QUOTES, 'UTF-8'); ?>',
                    '<?php echo !empty($row['archivo_fut_justificacion']) ? '1' : '0'; ?>',
                    '<?php echo !empty($row['archivo_documento_justificacion']) ? '1' : '0'; ?>'
                )">
                    <td><?php echo htmlspecialchars($row['DNI'], ENT_QUOTES, 'UTF-8'); ?></td>
                    <td><?php echo htmlspecialchars($row['nombresi'], ENT_QUOTES, 'UTF-8'); ?></td>
                </tr>
            <?php endwhile; ?>
        <?php else: ?>
            <tr>
                <td colspan="2">No hay datos para mostrar</td>
            </tr>
        <?php endif; ?>
        <?php $conn->close(); ?>
    </table>

    <!-- SEGUNDA TABLA-->
    <h2>Gestion de justificacion de inasistencias</h2><br><br>

    <h4>2024 - 1</h4>
    <button type="button">Aceptar</button>
    <button type="button">Rechazar</button>

    <table>
        <tr>
            <td><img src="../img/UNAM-SIN FONDO.png" alt=""></td>
            <td class="texto-centro">FORMULARIO ÚNICO DE TRÁMITE (FUT)</td>
            <td>
                <table class="tabla1">
                    <tr><td><input name="num_registro" id="num_registro" class="texto" readonly></td></tr>
                    <tr><td class="texto-centro">N° de Registro:</td></tr>
                </table>
            </td>
        </tr>
    </table>

    <table>
        <tr><td>I. SOLICITO:</td></tr>
        <tr><td><input name="tipo_solicitud" id="tipo_solicitud" class="texto" readonly></td></tr>
        <tr><td>II. DEPENDENCIA O AUTORIDAD A QUIEN SE DIRIGE LA SOLICITUD:</td></tr>
        <tr><td><input name="solicitud_dirige" id="solicitud_dirige" class="texto" readonly></td></tr>
    </table>

    <table>
        <tr><td colspan="4">IV. DATOS DEL SOLICITANTE:</td></tr>
        <tr><td colspan="3">PERSONA NATURAL</td><td class="texto-centro">DOCUMENTO DE IDENTIDAD</td></tr>
        <tr>
            <td class="texto-centro">Apellido Paterno</td>
            <td class="texto-centro">Apellido Materno</td>
            <td class="texto-centro">Nombres</td>
            <td><input id="documento_ident_pers_nat" readonly></td>
        </tr>
        <tr>
            <td><input name="apel_paterno_pers_nat" id="apel_paterno_pers_nat" class="texto" readonly></td>
            <td><input name="apel_materno_pers_nat" id="apel_materno_pers_nat" class="texto" readonly></td>
            <td><input name="nombres_pers_nat" id="nombres_pers_nat" class="texto" readonly></td>
            <td>N° <input name="num_doc_pers_nat" id="num_doc_pers_nat" class="texto-N" readonly></td>
        </tr>
    </table>

    <table>
        <tr><td colspan="3">V. DIRECCION:</td></tr>
        <tr><td colspan="3" class="texto-centro">DOMICILIO : AV. /CALLE / JIRÓN / DPTO. / MZ. / LOTE / URB.</td></tr>
        <tr><td colspan="3"><input name="domicilio" id="domicilio" class="texto" readonly></td></tr>
        <tr>
            <td class="texto-centro">DISTRITO</td>
            <td class="texto-centro">PROVINCIA</td>
            <td class="texto-centro">DEPARTAMENTO</td>
        </tr>
        <tr>
            <td><input name="distrito" id="distrito" class="texto" readonly></td>
            <td><input name="provincia" id="provincia" class="texto" readonly></td>
            <td><input name="departamento" id="departamento" class="texto" readonly></td>
        </tr>
        <tr>
            <td>CORREO ELECTRONICO: <input type="email" name="email" id="email" class="texto" readonly></td>
            <td>TELEFONO: <input name="telefono" id="telefono" class="texto" readonly></td>
            <td>CELULAR: <input name="celular" id="celular" class="texto" readonly></td>
        </tr>
    </table>

    <table>
        <tr><td>VI. FUNDAMENTACION DE LA SOLICITUD (PETITORIO - Indicar en forma clara lo que se solicita):</td></tr>
        <tr><td><textarea name="fundamento_solicitud" id="fundamento_solicitud" class="texto" readonly></textarea></td></tr>
    </table>

    <table>
        <tr><td>VII. ANEXOS (Documento de justificacion):</td></tr>
        <tr>
            <td>
                <table class="tabla1">
                    <tr>
                        <td>Descargar FUT</td>
                        <td>
                            <span id="descargar_fut">
                                <span>Archivo no disponible</span>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Descargar Justificación</td>
                        <td>
                            <span id="descargar_justificacion">
                                <span>Archivo no disponible</span>
                            </span>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <table class="tabla1">
                    <tr><td><input name="observaciones" id="observaciones" class="texto" readonly></td></tr>
                    <tr><td class="texto-centro">Observaciones</td></tr>
                </table>
            </td>
        </tr>
    </table><br><br>

    <script>
        function llenarCampos(id, solicitud, dependencia, tipo_documento, apellido_paterno, apellido_materno, nombre, dni, direccion, distrito, provincia, departamento, email, telefono, celular, fundamento_solicitud, codigo_estudiante, observaciones, archivoFutDisponibilidad, archivoJustificacionDisponibilidad) {
            document.getElementById('num_registro').value = id;
            document.getElementById('tipo_solicitud').value = solicitud;
            document.getElementById('solicitud_dirige').value = dependencia;
            document.getElementById('documento_ident_pers_nat').value = tipo_documento;
            document.getElementById('apel_paterno_pers_nat').value = apellido_paterno;
            document.getElementById('apel_materno_pers_nat').value = apellido_materno;
            document.getElementById('nombres_pers_nat').value = nombre;
            document.getElementById('num_doc_pers_nat').value = dni;
            document.getElementById('domicilio').value = direccion;
            document.getElementById('distrito').value = distrito;
            document.getElementById('provincia').value = provincia;
            document.getElementById('departamento').value = departamento;
            document.getElementById('email').value = email;
            document.getElementById('telefono').value = telefono;
            document.getElementById('celular').value = celular;
            document.getElementById('fundamento_solicitud').value = fundamento_solicitud;
            document.getElementById('codigo_estudiante').value = codigo_estudiante;
            document.getElementById('observaciones').value = observaciones;

            var enlaceDescargaFut = document.getElementById('enlace_descarga_fut');
            var enlaceDescargaJustificacion = document.getElementById('enlace_descarga_justificacion');
            
            var descargarFut = document.getElementById('descargar_fut');
            var descargarJustificacion = document.getElementById('descargar_justificacion');

            if (archivoFutDisponibilidad === '1') {
                descargarFut.innerHTML = '<a id="enlace_descarga_fut" href="descarga_inasistencias/1_fut_justificacion.php?id=' + id + '" target="_blank">Descargar Archivo</a>';
            } else {
                descargarFut.innerHTML = '<span>Archivo no disponible</span>';
            }

            if (archivoJustificacionDisponibilidad === '1') {
                descargarJustificacion.innerHTML = '<a id="enlace_descarga_justificacion" href="descarga_inasistencias/1_documento_justificacion.php?id=' + id + '" target="_blank">Descargar Archivo</a>';
            } else {
                descargarJustificacion.innerHTML = '<span>Archivo no disponible</span>';
            }
        }
    </script>
</body>
</html>
